import { TransferBillAttributes } from '../../../../src/money/attributes/TransferBillAttributes.js';
import { RootTrustBase } from '../../../../src/RootTrustBase.js';
import { OwnerProofAuthProof } from '../../../../src/transaction/proofs/OwnerProofAuthProof.js';
import { TransactionRecordWithProof } from '../../../../src/transaction/record/TransactionRecordWithProof.js';
import { DefaultVerificationPolicy } from '../../../../src/transaction/verification/DefaultVerificationPolicy.js';
import { VerificationResultCode } from '../../../../src/transaction/verification/VerificationResult.js';
import { Base16Converter } from '../../../../src/util/Base16Converter.js';

describe('Proof verification', () => {
  it('Verify proof', async () => {
    const data = TransactionRecordWithProof.fromCbor(
      Base16Converter.decode(
        '82D903F78301D903F88B0103015821933B2EDEA8700BB2CB96F6EAC9973BE163D171DC34BA8B516F9D207AB8336C2E0101831A05F5E1005826830041025820F52022BB450407D92F13BF1C53128A676BCF304818E9F41A5EF4EBEAE9C0D6B000F68418200A5821E80ACF4E961C2CDC8CE349DF0C01354E954DDE1B834106FA3C41767950826AFA1040F6815867825841E83534DF459939EA0EF6FEC61905E314BCB37ECE69980C7F7E96C3D20B8D2B804C61BC3D2A4144FD32D95928D9ED740650EEF8D91FC62532293DDCC0E119170600582103C30573DC0C7FD43FCB801289A6A96CB78C27F4BA398B89DA91ECE23E9A99ACA3586782584123F098C428D47881C6E6743CC4BB63501EC10959C7C31B897464D0DEAF4A1F3D7279CE0D2AFC6D5345E1844A693670E426030BFAED73BC7D640123E26DE2C4AE01582103C30573DC0C7FD43FCB801289A6A96CB78C27F4BA398B89DA91ECE23E9A99ACA38402825821933B2EDEA8700BB2CB96F6EAC9973BE163D171DC34BA8B516F9D207AB8336C2E015821E80ACF4E961C2CDC8CE349DF0C01354E954DDE1B834106FA3C41767950826AFA1001F6D903F184015820129ABC339E3F660615E3D1141E832821FA1672774583CCA0ECBD9C9A8CE9B58780D903EF8601D903F08A0117005820E9EBF00FEF35DBC487EEEFF6391F9612B58DD2A0D3F77B0FF671400FA45015A458201D6B5546F18C97B29106CC85D407C010D8717B2CB6375DA16D808F53915D215D481BC16D6742DC3E001A67F65A8558205FCB7953EDB011CBA5DD652B02E6954BED6FFA9ED417A6B3CFD294A8089443CB0258201204BCFBD26712DD23E8B2A3108D83AF5463D436680A9DC83812B770389BAE0E5820C7CFE21425EAA37C1FBFC9295F0DB06B3D7902E6BD9F7D77E34345861086AF1482418080D903F68401015820B1A213D02E5CE98E38D302C73966F0B35F42F4FB7BBD461491B912D1406A646180D903E98801031875001A67F65A875820E81B2B58DFF7A59FE1F4B96B92F0B6375F474ACDDB7D988129FCDC0592F329755820788A44DD943F8F8E597C4B00BF12871BF325E2EFF79D8C41722805C31F971BD3A1783531365569753248416D456D666B4E635761576A6734783645704D503761677658714B5736514E7844724A454247585474707639336E5841F059FED5A905FAC48D51C63EF4AC520AA4CB6F4BB6B2C0B51B24E61E1F1D93B815A12571BEF2050ABEB01559B329D3EB88091D65B98D003CD7371B6B78ACFEE800',
      ),
      TransferBillAttributes,
      OwnerProofAuthProof,
    );

    const trustBaseDto = JSON.parse(
      '{"version":1,"networkId":3,"epoch":1,"epochStartRound":1,"rootNodes":[{"nodeId":"16Uiu2HAmEmfkNcWaWjg4x6EpMP7agvXqKW6QNxDrJEBGXTtpv93n","sigKey":"0x03784c1ecb64473109791a9ad6c3259936cd6b20e575b800aba3c4fd387b58b63f","stake":1}],"quorumThreshold":1,"stateHash":"","changeRecordHash":"","previousEntryHash":"","signatures":{"16Uiu2HAmEmfkNcWaWjg4x6EpMP7agvXqKW6QNxDrJEBGXTtpv93n":"0x500f9b4295fe14940e1e155f7f515e9ba5c2790776bc2a436403424b6251ff407a148d2cbe967b88d6b58c632525ab69bbf3292b2eca10634a59eabd1eb26e8e01"}}',
    );

    const result = await new DefaultVerificationPolicy().verify({
      proof: data,
      trustBase: RootTrustBase.create(trustBaseDto),
    });

    console.log(result.toString());
    expect(result.resultCode).toBe(VerificationResultCode.OK);
  });
});
